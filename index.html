<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Deudores</title>
  <style>
    :root {
      --color-fondo: #121212;
      --color-principal: #10a37f;
      --color-texto: #e0e0e0;
      --color-blanco: #1e1e1e;
      --sombra: 0 4px 14px rgba(0, 0, 0, 0.6);
      --radio-borde: 12px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--color-fondo);
      margin: 0;
      padding: 40px;
      color: var(--color-texto);
    }

    h1 {
      color: var(--color-principal);
      font-size: 2rem;
      margin-bottom: 20px;
    }

    .input-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"], input[type="number"] {
      padding: 10px;
      border: 1px solid #555;
      border-radius: var(--radio-borde);
      background-color: #1e1e1e;
      color: var(--color-texto);
      flex: 1;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: var(--radio-borde);
      background-color: var(--color-principal);
      color: var(--color-texto);
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0e8d6c;
    }

    .persona {
      background-color: var(--color-blanco);
      padding: 20px;
      border-radius: var(--radio-borde);
      box-shadow: var(--sombra);
      margin-bottom: 15px;
    }

    .persona h3 {
      margin: 0 0 10px;
      color: var(--color-principal);
    }

    .acciones {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .total {
      margin-top: 30px;
      font-size: 1.2rem;
      color: var(--color-principal);
    }
  </style>
</head>
<body>
  <h1>Lista de Personas que Deben Dinero</h1>

  <div class="input-container">
    <input type="text" id="nombre" placeholder="Nombre de la persona">
    <button onclick="agregarPersona()">Agregar Persona</button>
  </div>

  <div id="lista"></div>

  <div class="total">
    Total general debido: $<span id="totalGeneral">0</span><br>
    Deuda histórica general: $<span id="deudaHistoricaGeneral">0</span>
  </div>

  <script>
    let db;
    let deudaHistoricaGeneral = 0;

    // Abrir la base de datos
    const request = indexedDB.open("DeudoresDB", 1);

    request.onupgradeneeded = function(event) {
      db = event.target.result;
      if (!db.objectStoreNames.contains("deudores")) {
        db.createObjectStore("deudores", { keyPath: "id", autoIncrement: true });
      }
    };

    request.onerror = function(event) {
      console.log("Error al abrir la base de datos:", event.target.errorCode);
    };

    request.onsuccess = function(event) {
      db = event.target.result;
      obtenerPersonas(); // Cargar la lista de deudores al iniciar
    };

    // Agregar una persona a la base de datos
    function agregarPersona() {
      const nombre = document.getElementById('nombre').value.trim();
      if (nombre === '') return;

      const transaction = db.transaction("deudores", "readwrite");
      const store = transaction.objectStore("deudores");

      const nuevaPersona = {
        nombre: nombre,
        deudaActual: 0,
        deudaHistorial: 0,
      };

      store.add(nuevaPersona);

      transaction.oncomplete = function() {
        document.getElementById('nombre').value = '';
        obtenerPersonas(); // Recargar la lista después de agregar
      };

      transaction.onerror = function(event) {
        console.log("Error al agregar la persona:", event.target.errorCode);
      };
    }

    // Actualizar la deuda de una persona
    function actualizarDeuda(index, cantidad) {
      const transaction = db.transaction("deudores", "readwrite");
      const store = transaction.objectStore("deudores");
      const request = store.get(index);

      request.onsuccess = function(event) {
        const persona = event.target.result;
        persona.deudaActual += cantidad;
        if (cantidad > 0) {
          persona.deudaHistorial += cantidad;
          deudaHistoricaGeneral += cantidad;
        }

        store.put(persona); // Actualizar el objeto en la base de datos
        transaction.oncomplete = function() {
          obtenerPersonas(); // Recargar la lista después de actualizar
        };
      };

      request.onerror = function(event) {
        console.log("Error al actualizar la deuda:", event.target.errorCode);
      };
    }

    // Obtener todas las personas de la base de datos
    function obtenerPersonas() {
      const transaction = db.transaction("deudores", "readonly");
      const store = transaction.objectStore("deudores");
      const request = store.getAll();

      request.onsuccess = function() {
        const personas = request.result;
        renderLista(personas);
      };
    }

    // Renderizar la lista de personas
    function renderLista(personas) {
      const lista = document.getElementById('lista');
      lista.innerHTML = '';

      let totalGeneral = 0;

      personas.forEach((persona, index) => {
        totalGeneral += persona.deudaActual;

        const div = document.createElement('div');
        div.className = 'persona';

        div.innerHTML = `
          <h3>${persona.nombre}</h3>
          <p>Deuda actual: $${persona.deudaActual.toFixed(2)}</p>
          <p>Deuda total histórica: $${persona.deudaHistorial.toFixed(2)}</p>
          <div class="acciones">
            <input type="number" id="monto-${index}" placeholder="Monto">
            <button onclick="actualizarDeuda(${index + 1}, parseFloat(document.getElementById('monto-${index}').value) || 0)">Sumar</button>
            <button onclick="actualizarDeuda(${index + 1}, -1 * (parseFloat(document.getElementById('monto-${index}').value) || 0))">Restar</button>
          </div>
        `;

        lista.appendChild(div);
      });

      document.getElementById('totalGeneral').textContent = totalGeneral.toFixed(2);
      document.getElementById('deudaHistoricaGeneral').textContent = deudaHistoricaGeneral.toFixed(2);
    }
  </script>
</body>
</html>
