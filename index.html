<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Deudores</title>
  <style>
    :root {
      --color-fondo: #121212;
      --color-principal: #10a37f;
      --color-texto: #e0e0e0;
      --color-blanco: #1e1e1e;
      --sombra: 0 4px 14px rgba(0, 0, 0, 0.6);
      --radio-borde: 12px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--color-fondo);
      margin: 0;
      padding: 40px;
      color: var(--color-texto);
    }

    h1 {
      color: var(--color-principal);
      font-size: 2rem;
      margin-bottom: 20px;
    }

    .input-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"],
    input[type="number"],
    select {
      padding: 10px;
      border: 1px solid #555;
      border-radius: var(--radio-borde);
      background-color: #1e1e1e;
      color: var(--color-texto);
      flex: 1;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: var(--radio-borde);
      background-color: var(--color-principal);
      color: var(--color-texto);
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0e8d6c;
    }

    .persona {
      background-color: var(--color-blanco);
      padding: 20px;
      border-radius: var(--radio-borde);
      box-shadow: var(--sombra);
      margin-bottom: 15px;
    }

    .persona h3 {
      margin: 0 0 10px;
      color: var(--color-principal);
    }

    .acciones {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .total {
      margin-top: 30px;
      font-size: 1.2rem;
      color: var(--color-principal);
    }

    .historial {
      margin-top: 40px;
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: var(--radio-borde);
      box-shadow: var(--sombra);
    }

    .historial h2 {
      margin-top: 0;
      color: var(--color-principal);
    }

    .movimiento {
      margin-bottom: 8px;
      border-bottom: 1px solid #333;
      padding-bottom: 6px;
    }
  </style>
</head>
<body>
  <h1>Lista de Personas que Deben Dinero</h1>

  <div class="input-container">
    <input type="text" id="nombre" placeholder="Nombre de la persona">
    <button onclick="agregarPersona()">Agregar Persona</button>
  <div class="input-container">
    <button onclick="exportarDatos()">Exportar Datos (.txt)</button>
    <input type="file" id="importarArchivo" accept=".txt" onchange="importarDatos(event)">
    <button onclick="borrarTodo()">Borrar Toda la Base de Datos</button>
  </div>

  </div>

  <div id="lista"></div>

  <div class="total">
    Total general debido: $<span id="totalGeneral">0</span><br>
    Deuda histórica general: $<span id="deudaHistoricaGeneral">0</span>
  </div>

  <div class="historial">
    <h2>Historial de movimientos</h2>
    <div class="input-container">
      <select id="filtroPersona" onchange="renderHistorial()">
        <option value="">Todas las personas</option>
      </select>
      <button onclick="exportarHistorial()">Exportar Historial</button>
      <button onclick="exportarListaSimple()">Exportar lista simple</button>
    </div>
    <div id="historialMovimientos"></div>
  </div>

  <script>
    let personas = [];
    let deudaHistoricaGeneral = 0;
    let historialMovimientos = [];

    function guardarDatos() {
      localStorage.setItem('personas', JSON.stringify(personas));
      localStorage.setItem('deudaHistoricaGeneral', deudaHistoricaGeneral);
      localStorage.setItem('historialMovimientos', JSON.stringify(historialMovimientos));
    }

    function cargarDatos() {
      const datosPersonas = localStorage.getItem('personas');
      const deudaHistorica = localStorage.getItem('deudaHistoricaGeneral');
      const historial = localStorage.getItem('historialMovimientos');

      if (datosPersonas) personas = JSON.parse(datosPersonas);
      if (deudaHistorica) deudaHistoricaGeneral = parseFloat(deudaHistorica);
      if (historial) historialMovimientos = JSON.parse(historial);
    }

    function agregarPersona() {
      const nombre = document.getElementById('nombre').value.trim();
      if (nombre === '') return;

      const persona = {
        nombre,
        deudaActual: 0,
        deudaHistorial: 0
      };

      personas.push(persona);
      document.getElementById('nombre').value = '';
      guardarDatos();
      renderLista();
    }

    function actualizarDeuda(index, cantidad) {
      const persona = personas[index];
      persona.deudaActual += cantidad;
      if (cantidad > 0) {
        persona.deudaHistorial += cantidad;
        deudaHistoricaGeneral += cantidad;
      }

      const fecha = new Date().toLocaleString();
      const tipo = cantidad > 0 ? 'Sumó' : 'Restó';
      historialMovimientos.unshift({
        fecha,
        persona: persona.nombre,
        accion: tipo,
        cantidad: Math.abs(cantidad)
      });

      guardarDatos();
      renderLista();
    }

    function renderLista() {
      const lista = document.getElementById('lista');
      lista.innerHTML = '';

      let totalGeneral = 0;

      personas.forEach((p, i) => {
        totalGeneral += p.deudaActual;

        const div = document.createElement('div');
        div.className = 'persona';

        div.innerHTML = `
          <h3>${p.nombre}</h3>
          <p>Deuda actual: $${p.deudaActual.toFixed(2)}</p>
          <p>Deuda total histórica: $${p.deudaHistorial.toFixed(2)}</p>
          <div class="acciones">
            <input type="number" id="monto-${i}" placeholder="Monto">
            <button onclick="actualizarDeuda(${i}, parseFloat(document.getElementById('monto-${i}').value) || 0)">Sumar</button>
            <button onclick="actualizarDeuda(${i}, -1 * (parseFloat(document.getElementById('monto-${i}').value) || 0))">Restar</button>
          <button onclick="eliminarPersona(${i})">Eliminar</button></div>
        `;

        lista.appendChild(div);
      });

      document.getElementById('totalGeneral').textContent = totalGeneral.toFixed(2);
      document.getElementById('deudaHistoricaGeneral').textContent = deudaHistoricaGeneral.toFixed(2);

      const filtroSelect = document.getElementById('filtroPersona');
      filtroSelect.innerHTML = '<option value="">Todas las personas</option>';
      personas.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.nombre;
        opt.textContent = p.nombre;
        filtroSelect.appendChild(opt);
      });

      renderHistorial();
    }

    function renderHistorial() {
      const historialDiv = document.getElementById('historialMovimientos');
      const filtro = document.getElementById('filtroPersona').value;
      const filtrado = historialMovimientos.filter(m => !filtro || m.persona === filtro);
      historialDiv.innerHTML = filtrado.slice(0, 20).map(m => `<div class="movimiento">${m.fecha}: ${m.accion} $${m.cantidad.toFixed(2)} a ${m.persona}</div>`).join('');
    }

    function exportarHistorial() {
      const filtro = document.getElementById('filtroPersona').value;
      const filtrado = historialMovimientos.filter(m => !filtro || m.persona === filtro);
      const texto = filtrado.map(m => `${m.fecha}: ${m.accion} $${m.cantidad.toFixed(2)} a ${m.persona}`).join('\n');
      const blob = new Blob([texto], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'historial.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    
    function eliminarPersona(index) {
      if (!confirm('¿Eliminar esta persona?')) return;
      const nombre = personas[index].nombre;
      historialMovimientos = historialMovimientos.filter(m => m.persona !== nombre);
      personas.splice(index, 1);
      guardarDatos();
      renderLista();
    }

    function borrarTodo() {
      if (!confirm('¿Seguro que deseas borrar todos los datos?')) return;
      personas = [];
      historialMovimientos = [];
      deudaHistoricaGeneral = 0;
      guardarDatos();
      renderLista();
    }

    function exportarDatos() {
      let texto = '*** PERSONAS ***\n';
      personas.forEach(p => {
        texto += `Nombre: ${p.nombre}\nDeuda actual: $${p.deudaActual.toFixed(2)}\nDeuda histórica: $${p.deudaHistorial.toFixed(2)}\n---\n`;
      });

      texto += '\n*** HISTORIAL ***\n';
      historialMovimientos.forEach(m => {
        texto += `${m.fecha}: ${m.accion} $${m.cantidad.toFixed(2)} a ${m.persona}\n`;
      });

      const blob = new Blob([texto], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'datos_completos.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importarDatos(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const contenido = e.target.result;
        const partes = contenido.split('*** HISTORIAL ***');
        const personasTxt = partes[0].split('*** PERSONAS ***')[1].trim().split('---\n');
        const historialTxt = partes[1].trim().split('\n');

        personas = personasTxt.map(bloque => {
          const lineas = bloque.trim().split('\n');
          return {
            nombre: lineas[0].split(': ')[1],
            deudaActual: parseFloat(lineas[1].split('$')[1]),
            deudaHistorial: parseFloat(lineas[2].split('$')[1])
          };
        });

        historialMovimientos = historialTxt.map(linea => {
          const [fechaAccion, resto] = linea.split(': ');
          const [accionMonto, persona] = resto.split(' a ');
          const [accion, montoStr] = accionMonto.split(' $');
          return {
            fecha: fechaAccion,
            accion: accion,
            cantidad: parseFloat(montoStr),
            persona: persona
          };
        });

        deudaHistoricaGeneral = personas.reduce((acc, p) => acc + p.deudaHistorial, 0);
        guardarDatos();
        renderLista();
      };
      reader.readAsText(file);
    }


    cargarDatos();
    renderLista();
    function exportarListaSimple() {
  const texto = personas.map(p => `${p.nombre}:${p.deudaActual.toFixed(2)}`).join('\n');
  const blob = new Blob([texto], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'lista_simple.txt';
  a.click();
  URL.revokeObjectURL(url);
}
    
  </script>
</body>
</html>
